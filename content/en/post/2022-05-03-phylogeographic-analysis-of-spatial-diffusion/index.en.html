---
title: Phylogeographic analysis of spatial diffusion
author: Alejandro Manuel Ferreiro
date: '2022-05-03'
slug: phylogeographic-analysis-of-spatial-diffusion
categories:
  - Genetics
  - Phylogeography
tags:
  - BEAST
subtitle: ''
summary: ''
authors: []
lastmod: '2022-05-03T09:57:13-03:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The analyzes implemented in phylogeographic studies have traditionally allowed inferring the genetic structure and demographic processes that have shaped the current distribution of genetic lineages. Many times these demographic changes have been implicitly associated with range expansions of the species. However, these analyzes do not explicitly test these hypotheses. To do this, in this post we are going to introduce ourselves to the use of the SPREAD application. This software allows the explicit reconstruction of the distribution of lineages in space and time, taking into account the phylogenetic uncertainty (posterior probability of the nodes), and the spatial diffusion process (Kms in Ma).</p>
<p>This post is an adaptation of <a href="http://beast.community/workshop_continuous_diffusion_yfv">BEAST tutorial</a>.</p>
</div>
<div id="software-needed" class="section level1">
<h1>Software needed</h1>
<ol style="list-style-type: decimal">
<li>BEAUTi</li>
<li>BEAST v. 1.10.4</li>
<li>TRACER v. 1.7.2</li>
<li>Tree Annotator</li>
<li>spreaD3</li>
</ol>
</div>
<div id="cómo-realizo-el-análisis-de-difusión-espacial" class="section level1">
<h1>¿Cómo realizo el análisis de difusión espacial?</h1>
<div id="archivos-iniciales" class="section level2">
<h2>Archivos iniciales</h2>
<p>Para comenzar se debe partir de un <a href="./docs/sequences.fas">archivo fasta</a> que contiene las secuencias a usar, y un <a href="./docs/coordinates.nex">archivo nexus</a> con las coordenadas de las mismas. Además se requiere conocer el modelo evolutivo que mejor se ajusta a la matriz de secuencias, el cual puede ser calculados en algún software como <a href="https://github.com/ddarriba/jmodeltest2">jModelTest</a>.</p>
<p>Además de estos archivos, con el objetivo de representar y visualizar geograficamente la dinámica espacial de la especie se necesitará un archivo geográfico vectorial del tipo geojson. Este se puede obtener en R mediante el siguiente código:</p>
<pre class="r"><code>library(sf)</code></pre>
<pre><code>## Linking to GEOS 3.9.1, GDAL 3.4.3, PROJ 7.2.1; sf_use_s2() is TRUE</code></pre>
<pre class="r"><code>library(rnaturalearth)

# Descarga de poligono con limites de paises sudamericanos:
Sudam = ne_states(iso_a2 = c(&quot;AR&quot;, &quot;BO&quot;, &quot;PY&quot;, &quot;BR&quot;, &quot;CL&quot;, &quot;UY&quot;, &quot;PE&quot;, &quot;EC&quot;, &quot;VE&quot;, &quot;CO&quot;, &quot;GY&quot;, &quot;SR&quot;, &quot;FR&quot;),
                                     returnclass = &quot;sf&quot;)
write_sf(obj = Sudam, dsn = &quot;./ProvSudam.geojson&quot;)</code></pre>
</div>
<div id="beauti-v.-1.10.4" class="section level2">
<h2>BEAUTi v. 1.10.4</h2>
<p>En este programa vamos a preparar nuestros datos para generar un archivo xml, que pueda ser leído por el programa BEAST. Para ello:
1. Importar el archivo <code>sequence.fas</code>. Una vez importado chequear en la solapa <code>Partitions</code> que los datos sean correctos.
2. Solapa <code>Traits</code>. Agregar una nueva partición de datos que contiene las coordenadas geográficas. Hacer click en <code>Import traits</code> para importar el <code>coordinates.nex</code>. Una vez importado, clickear en <code>Create partition from trait...</code> y nombrarla como <code>location</code>.
3. Solapa <code>Sites</code>.
4. Solapa <code>Clocks</code>.
5. Solapa <code>Trees</code>.
6. Solapa <code>States</code>.
7. Solapa <code>Priors</code>.
8. Solapa <code>MCMC</code>.</p>
</div>
<div id="beast-v-1.10.4" class="section level2">
<h2>BEAST v 1.10.4</h2>
<p>Se puede correr el análisis en el software o BEAST, o bien utilizar algun servidor de internet como <a href="https://www.phylo.org/">CIPRES</a> para ahorrarle trabajo a nuestra maquina.</p>
</div>
<div id="tracer-1.7.2" class="section level2">
<h2>Tracer 1.7.2</h2>
<p>Luego de la corrida, debemos chequear que el analisis haya tenido un largo de cadena suficiente para alcanzar valores de ESS mayores a 200 (convergencia). Para esto abrimos el archivo <code>.log</code> generado en el programa Tracer.
Si los de ESS presentan probabilidad posterior mayores que 200, podemos chequear la <strong>tasa de difusión</strong> que se encuentra como <code>location.diffusionRate</code>. Esta indica en km/año. En especies, donde existen datos sobre tasas de dispersión este valor resulta importante para ser contrastado con estudio previos.</p>
</div>
<div id="treeannotator-v.-1.10.4" class="section level2">
<h2>TreeAnnotator v. 1.10.4</h2>
<p>Este software permite generar arboles que resumen la información de los 10000 árboles recuperados mediantes inferencia bayesiana. En este software se debe definir el <code>Burn-in</code> o quemado de árboles que tienen menor probabilidad posterior, Usualmente se descarta o “quema” un 12-25% de los arboles (Usualmente se busca obtener un total de 10000 arboles antes del quemado).
Dejar el resto de las opciones por dewfault, y cargar el archivo que generó el BEAST con extensión <code>.trees</code>. Como output se puede generar un archivo con extensión <code>.tree</code> que pueda ser leído en <a href="http://tree.bio.ed.ac.uk/software/figtree/">Figtree</a>.</p>
</div>
<div id="spread3" class="section level2">
<h2>spreaD3</h2>
<p>Finalmente para generar los patrones espaciales de difusión de los haplotipos y sus ancestros se debe abrir el software spreaD3.
* Solapa <code>Data</code>. Cargo el archivo .tree generado a partir del TreeAnontator. A continuación seleccionar el latitud como <code>location1</code> y longitud como <code>location2</code>. Cargar un archivo geojson que contenga el mapa de fondo como por ejemplo mapa politico mundial. Click en <code>Generate JSON</code> y nombrar el archivo json de salida, incluyendo la extensión .json.
* Solapa <code>Rendering</code>. Cargar el archivo json generado en la solapa anterior. Renderizarlo de forma kml, definiendo el nombre seguido de la extensión.
* Esto generarà un archivo .kml en la carpeta que luego puede ser abierto usando el google earth.</p>
</div>
</div>
